{% extends 'base.html' %}
{% block title %}task{% endblock %}

{% block style %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
{% endblock %}

{% block content %}

{% if 'maker' in user_groups %}
<a href="/task/task_create" type="button" class="btn btn-primary mb-2">Create Task</a>
<button id="refresh_table" class="btn btn-secondary mb-2">Refresh</button>
{% endif %}
<table id="task_list" class="display" style="width:100%;">
    <thead>
    <tr>
        <th>Title</th>
        <th>Source</th>
        <th>Content</th>
        <th></th>
    </tr>
    </thead>
</table>


{% endblock %}

{% block script %}
<script charset="utf8" src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script charset="utf8"
        src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script>
    let table = $('#task_list').DataTable({
        "ajax": {
            "url": "/task/dt_task",
        },
        "processing": true,
        "serverSide": true,
        "columns": [
            {"data": "title"},
            {"data": "source"},
            {
                "width": "30%",
                "data": "content"
            },
            {
                "data": null, // This is for the Edit button
                "orderable": false, // Disable sorting for this column
                "searchable": false, // Disable searching for this column
                "render": function (data, type, row) {
                    return '<button class="btn btn-primary edit-task ml-2" data-edit_url ="' + row.edit_url + '">Edit</button>' +
                    '<button class="btn btn-danger delete-task" data-delete_url="' + row.delete_url + '">Delete</button>';
                }
            },
    
        ],
        "language": {
            search: '<i class="fa fa-filter" aria-hidden="true">Search</i>',
            searchPlaceholder: 'Enter Title or Source'
        },
    });

    // Handle the Edit button click event
    $('#task_list tbody').on('click', '.edit-task', function () {
        console.log($(this).data('edit_url'))
        window.location.replace($(this).data('edit_url'))
    });
    $('#task_list tbody').on('click', '.delete-task', function () {
    if (window.confirm('Are you sure you want to delete this task?')) {
        window.location.href = $(this).data('delete_url');
    }

    // Handle the Refresh button click event
    $('#refresh_table').on('click', function () {
        table.ajax.reload();
    });
});
</script>
{% endblock %}
